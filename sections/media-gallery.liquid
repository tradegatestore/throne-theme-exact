{{ 'section-media-gallery.css' | asset_url | stylesheet_tag }}

<section class="media-gallery section-{{ section.id }}" data-section-id="{{ section.id }}">
  <div class="media-gallery__container {% if section.settings.full_width %}media-gallery__container--full{% else %}page-width{% endif %}">
    {% if section.settings.heading != blank %}
      <div class="media-gallery__header" data-scroll-reveal>
        <h2 class="media-gallery__title h1">{{ section.settings.heading }}</h2>
        {% if section.settings.subheading != blank %}
          <p class="media-gallery__subtitle">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}
    
    <div class="media-gallery__grid media-gallery__grid--{{ section.settings.layout }}" data-gallery-grid>
      {% for block in section.blocks %}
        <div 
          class="media-gallery__item media-gallery__item--{{ block.settings.size }}" 
          data-scroll-reveal 
          data-delay="{{ forloop.index | times: 100 }}"
          {{ block.shopify_attributes }}
        >
          <a 
            href="{% if block.settings.link != blank %}{{ block.settings.link }}{% else %}#{% endif %}" 
            class="media-gallery__link"
            {% if block.settings.link == blank %}data-lightbox="true"{% endif %}
          >
            <div class="media-gallery__media-wrapper">
              {% if block.type == 'image' %}
                {% if block.settings.image %}
                  <img 
                    src="{{ block.settings.image | img_url: '1200x' }}"
                    alt="{{ block.settings.image.alt | escape }}"
                    class="media-gallery__media"
                    loading="lazy"
                  >
                {% else %}
                  {{ 'lifestyle-1' | placeholder_svg_tag: 'media-gallery__placeholder' }}
                {% endif %}
              {% elsif block.type == 'video' %}
                <video 
                  class="media-gallery__media media-gallery__video"
                  autoplay 
                  muted 
                  loop 
                  playsinline
                >
                  <source src="{{ block.settings.video_url }}" type="video/mp4">
                </video>
              {% endif %}
              
              <div class="media-gallery__overlay">
                {% if block.settings.caption != blank %}
                  <span class="media-gallery__caption">{{ block.settings.caption }}</span>
                {% endif %}
                <span class="media-gallery__icon">
                  {% if block.settings.link != blank %}
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
                  {% else %}
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                  {% endif %}
                </span>
              </div>
            </div>
          </a>
        </div>
      {% else %}
        {% for i in (1..6) %}
          <div class="media-gallery__item media-gallery__item--{% cycle 'large', 'small', 'small', 'medium', 'small', 'large' %}" data-scroll-reveal>
            <div class="media-gallery__link">
              <div class="media-gallery__media-wrapper">
                {{ 'lifestyle-1' | placeholder_svg_tag: 'media-gallery__placeholder' }}
              </div>
            </div>
          </div>
        {% endfor %}
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .media-gallery { padding: 80px 0; background: var(--color-background); overflow: hidden; }
  .media-gallery__container--full { max-width: none; padding: 0; }
  .media-gallery__header { text-align: center; margin-bottom: 50px; opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .media-gallery__header.is-visible { opacity: 1; transform: translateY(0); }
  .media-gallery__title { font-size: clamp(2rem, 5vw, 3.5rem); margin: 0 0 15px; letter-spacing: -0.02em; }
  .media-gallery__subtitle { font-size: 1.1rem; color: var(--color-text-muted, #666); max-width: 600px; margin: 0 auto; }
  .media-gallery__grid { display: grid; gap: 15px; }
  .media-gallery__grid--masonry { grid-template-columns: repeat(4, 1fr); grid-auto-rows: 200px; }
  .media-gallery__grid--grid { grid-template-columns: repeat(3, 1fr); }
  .media-gallery__item { opacity: 0; transform: translateY(40px) scale(0.95); transition: all 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .media-gallery__item.is-visible { opacity: 1; transform: translateY(0) scale(1); }
  .media-gallery__item--large { grid-column: span 2; grid-row: span 2; }
  .media-gallery__item--medium { grid-column: span 2; grid-row: span 1; }
  .media-gallery__item--small { grid-column: span 1; grid-row: span 1; }
  .media-gallery__link { display: block; width: 100%; height: 100%; position: relative; overflow: hidden; border-radius: 12px; text-decoration: none; color: inherit; }
  .media-gallery__media-wrapper { width: 100%; height: 100%; position: relative; overflow: hidden; }
  .media-gallery__media { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .media-gallery__link:hover .media-gallery__media { transform: scale(1.1); }
  .media-gallery__overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 60%); display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start; padding: 25px; opacity: 0; transition: opacity 0.4s ease; }
  .media-gallery__link:hover .media-gallery__overlay { opacity: 1; }
  .media-gallery__caption { color: #fff; font-size: 1rem; font-weight: 500; margin-bottom: 10px; transform: translateY(10px); transition: transform 0.4s ease; }
  .media-gallery__link:hover .media-gallery__caption { transform: translateY(0); }
  .media-gallery__icon { width: 40px; height: 40px; border-radius: 50%; background: var(--color-accent, #c8f542); display: flex; align-items: center; justify-content: center; color: #000; transform: translateY(20px); transition: transform 0.4s ease 0.1s; }
  .media-gallery__link:hover .media-gallery__icon { transform: translateY(0); }
  .media-gallery__placeholder { width: 100%; height: 100%; background: var(--color-card-bg, #f0f0f0); }
  @media (max-width: 1024px) { .media-gallery__grid--masonry { grid-template-columns: repeat(3, 1fr); grid-auto-rows: 180px; } }
  @media (max-width: 768px) { .media-gallery__grid--masonry { grid-template-columns: repeat(2, 1fr); grid-auto-rows: 150px; } .media-gallery__item--large { grid-column: span 2; } .media-gallery { padding: 50px 0; } }
  @media (max-width: 480px) { .media-gallery__grid--masonry { grid-template-columns: 1fr; grid-auto-rows: auto; } .media-gallery__item--large, .media-gallery__item--medium { grid-column: span 1; } .media-gallery__link { aspect-ratio: 4/3; } }
</style>

<script>
  (function() {
    const section = document.querySelector('.section-{{ section.id }}');
    if (!section) return;
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const delay = entry.target.dataset.delay || 0;
          setTimeout(() => entry.target.classList.add('is-visible'), delay);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    
    section.querySelectorAll('[data-scroll-reveal]').forEach(el => observer.observe(el));
  })();
</script>

{% schema %}
{
  "name": "Media Gallery",
  "tag": "section",
  "class": "section-media-gallery",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Gallery" },
    { "type": "text", "id": "subheading", "label": "Subheading" },
    { "type": "checkbox", "id": "full_width", "label": "Full width", "default": false },
    { "type": "select", "id": "layout", "label": "Layout", "options": [{"value": "masonry", "label": "Masonry"}, {"value": "grid", "label": "Grid"}], "default": "masonry" }
  ],
  "blocks": [
    { "type": "image", "name": "Image", "settings": [
      { "type": "image_picker", "id": "image", "label": "Image" },
      { "type": "text", "id": "caption", "label": "Caption" },
      { "type": "url", "id": "link", "label": "Link" },
      { "type": "select", "id": "size", "label": "Size", "options": [{"value": "small", "label": "Small"}, {"value": "medium", "label": "Medium"}, {"value": "large", "label": "Large"}], "default": "small" }
    ]},
    { "type": "video", "name": "Video", "settings": [
      { "type": "text", "id": "video_url", "label": "Video URL (MP4)" },
      { "type": "text", "id": "caption", "label": "Caption" },
      { "type": "select", "id": "size", "label": "Size", "options": [{"value": "small", "label": "Small"}, {"value": "medium", "label": "Medium"}, {"value": "large", "label": "Large"}], "default": "medium" }
    ]}
  ],
  "presets": [{ "name": "Media Gallery" }]
}
{% endschema %}
