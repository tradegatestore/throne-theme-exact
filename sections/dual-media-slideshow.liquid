{{ 'dual-media-slideshow.css' | asset_url | stylesheet_tag }}

<div class="dual-media-slideshow" data-section-id="{{ section.id }}">
  <div class="dual-media-slideshow__container">
    <div class="dual-media-slideshow__slides" data-slides>
      {%- for block in section.blocks -%}
        <div class="dual-media-slideshow__slide {% if forloop.first %}is-active{% endif %}" data-slide-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
          <div class="dual-media-slideshow__grid">
            <!-- Left Panel -->
            <div class="dual-media-slideshow__panel dual-media-slideshow__panel--left">
              {%- if block.settings.left_image != blank -%}
                <div class="dual-media-slideshow__image-wrapper">
                  <img
                    src="{{ block.settings.left_image | image_url: width: 1200 }}"
                    alt="{{ block.settings.left_image.alt | escape }}"
                    class="dual-media-slideshow__image"
                    loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  >
                </div>
              {%- else -%}
                <div class="dual-media-slideshow__placeholder">
                  {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                </div>
              {%- endif -%}
              <div class="dual-media-slideshow__content dual-media-slideshow__content--left">
                {%- if block.settings.left_subheading != blank -%}
                  <p class="dual-media-slideshow__subheading">{{ block.settings.left_subheading }}</p>
                {%- endif -%}
                {%- if block.settings.left_heading != blank -%}
                  <h2 class="dual-media-slideshow__heading">
                    <span class="dual-media-slideshow__heading-line1">{{ block.settings.left_heading }}</span>
                    {%- if block.settings.left_heading_highlight != blank -%}
                      <span class="dual-media-slideshow__heading-highlight">{{ block.settings.left_heading_highlight }}</span>
                    {%- endif -%}
                  </h2>
                {%- endif -%}
                {%- if block.settings.left_text != blank -%}
                  <p class="dual-media-slideshow__text">{{ block.settings.left_text }}</p>
                {%- endif -%}
              </div>
            </div>
            <!-- Right Panel -->
            <div class="dual-media-slideshow__panel dual-media-slideshow__panel--right" style="background-color: {{ block.settings.right_bg_color }};">
              {%- if block.settings.right_image != blank -%}
                <div class="dual-media-slideshow__image-wrapper dual-media-slideshow__image-wrapper--right">
                  <img
                    src="{{ block.settings.right_image | image_url: width: 800 }}"
                    alt="{{ block.settings.right_image.alt | escape }}"
                    class="dual-media-slideshow__image dual-media-slideshow__image--product"
                    loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  >
                </div>
              {%- endif -%}
              <div class="dual-media-slideshow__content dual-media-slideshow__content--right">
                {%- if block.settings.right_heading != blank -%}
                  <h3 class="dual-media-slideshow__right-heading">{{ block.settings.right_heading }}</h3>
                {%- endif -%}
                {%- if block.settings.right_text != blank -%}
                  <p class="dual-media-slideshow__right-text">{{ block.settings.right_text }}</p>
                {%- endif -%}
                <div class="dual-media-slideshow__buttons">
                  {%- if block.settings.button_1_label != blank -%}
                    <a href="{{ block.settings.button_1_link }}" class="dual-media-slideshow__button dual-media-slideshow__button--outline">{{ block.settings.button_1_label }}</a>
                  {%- endif -%}
                  {%- if block.settings.button_2_label != blank -%}
                    <a href="{{ block.settings.button_2_link }}" class="dual-media-slideshow__button dual-media-slideshow__button--solid">{{ block.settings.button_2_label }}</a>
                  {%- endif -%}
                </div>
              </div>
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
    <!-- Navigation Arrows -->
    <button class="dual-media-slideshow__nav dual-media-slideshow__nav--prev" data-prev aria-label="Previous slide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <button class="dual-media-slideshow__nav dual-media-slideshow__nav--next" data-next aria-label="Next slide">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <!-- Pagination Dots -->
    <div class="dual-media-slideshow__pagination" data-pagination>
      {%- for block in section.blocks -%}
        <button class="dual-media-slideshow__dot {% if forloop.first %}is-active{% endif %}" data-dot="{{ forloop.index0 }}" aria-label="Go to slide {{ forloop.index }}"></button>
      {%- endfor -%}
    </div>
  </div>
</div>

<script>
  class DualMediaSlideshow extends HTMLElement {
    constructor() {
      super();
      this.slides = this.querySelectorAll('[data-slide-index]');
      this.dots = this.querySelectorAll('[data-dot]');
      this.prevBtn = this.querySelector('[data-prev]');
      this.nextBtn = this.querySelector('[data-next]');
      this.currentIndex = 0;
      this.autoplayInterval = null;
      this.autoplayDelay = {{ section.settings.autoplay_speed }}000;
      this.init();
    }
    init() {
      if (this.prevBtn) this.prevBtn.addEventListener('click', () => this.prev());
      if (this.nextBtn) this.nextBtn.addEventListener('click', () => this.next());
      this.dots.forEach(dot => {
        dot.addEventListener('click', () => this.goTo(parseInt(dot.dataset.dot)));
      });
      if ({{ section.settings.autoplay }}) this.startAutoplay();
      this.addEventListener('mouseenter', () => this.stopAutoplay());
      this.addEventListener('mouseleave', () => { if ({{ section.settings.autoplay }}) this.startAutoplay(); });
    }
    goTo(index) {
      this.slides[this.currentIndex].classList.remove('is-active');
      this.dots[this.currentIndex].classList.remove('is-active');
      this.currentIndex = index;
      if (this.currentIndex >= this.slides.length) this.currentIndex = 0;
      if (this.currentIndex < 0) this.currentIndex = this.slides.length - 1;
      this.slides[this.currentIndex].classList.add('is-active');
      this.dots[this.currentIndex].classList.add('is-active');
    }
    next() { this.goTo(this.currentIndex + 1); }
    prev() { this.goTo(this.currentIndex - 1); }
    startAutoplay() { this.autoplayInterval = setInterval(() => this.next(), this.autoplayDelay); }
    stopAutoplay() { clearInterval(this.autoplayInterval); }
  }
  customElements.define('dual-media-slideshow', DualMediaSlideshow);
</script>

{% schema %}
{
  "name": "Dual Media Slideshow",
  "tag": "dual-media-slideshow",
  "class": "section-dual-media-slideshow",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "header", "content": "Left Panel" },
        { "type": "image_picker", "id": "left_image", "label": "Left image" },
        { "type": "text", "id": "left_subheading", "label": "Subheading", "default": "Crafted for audiophiles" },
        { "type": "text", "id": "left_heading", "label": "Heading line 1", "default": "Where" },
        { "type": "text", "id": "left_heading_highlight", "label": "Heading highlight", "default": "Excellence Meets" },
        { "type": "text", "id": "left_text", "label": "Description", "default": "Deep Resonance" },
        { "type": "header", "content": "Right Panel" },
        { "type": "image_picker", "id": "right_image", "label": "Right image (product)" },
        { "type": "color", "id": "right_bg_color", "label": "Right background color", "default": "#0891b2" },
        { "type": "text", "id": "right_heading", "label": "Heading", "default": "Pure Sound Elite" },
        { "type": "text", "id": "right_text", "label": "Subtext", "default": "Redefining modern tech. Starts at $132.99" },
        { "type": "text", "id": "button_1_label", "label": "Button 1 label", "default": "Explore" },
        { "type": "url", "id": "button_1_link", "label": "Button 1 link" },
        { "type": "text", "id": "button_2_label", "label": "Button 2 label", "default": "Shop Now" },
        { "type": "url", "id": "button_2_link", "label": "Button 2 link" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Dual Media Slideshow",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}
