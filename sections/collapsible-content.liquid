{{ 'section-collapsible-content.css' | asset_url | stylesheet_tag }}

<section class="collapsible-content section-{{ section.id }}" data-section-id="{{ section.id }}">
  <div class="collapsible-content__container page-width">
    <div class="collapsible-content__layout collapsible-content__layout--{{ section.settings.layout }}">
      {% if section.settings.heading != blank or section.settings.subheading != blank %}
        <div class="collapsible-content__header" data-scroll-reveal>
          {% if section.settings.heading != blank %}
            <h2 class="collapsible-content__title h1">{{ section.settings.heading }}</h2>
          {% endif %}
          {% if section.settings.subheading != blank %}
            <p class="collapsible-content__subtitle">{{ section.settings.subheading }}</p>
          {% endif %}
        </div>
      {% endif %}
      
      <div class="collapsible-content__items" data-accordion-wrapper>
        {% for block in section.blocks %}
          <div class="collapsible-content__item" data-accordion-item data-scroll-reveal data-delay="{{ forloop.index | times: 80 }}" {{ block.shopify_attributes }}>
            <button 
              class="collapsible-content__trigger" 
              type="button"
              aria-expanded="{% if forloop.first and section.settings.open_first %}true{% else %}false{% endif %}"
              aria-controls="accordion-content-{{ block.id }}"
              data-accordion-trigger
            >
              <span class="collapsible-content__trigger-text">
                {% if block.settings.icon != 'none' %}
                  <span class="collapsible-content__icon">
                    {% case block.settings.icon %}
                      {% when 'shipping' %}
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                      {% when 'returns' %}
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
                      {% when 'quality' %}
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                      {% when 'support' %}
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                    {% endcase %}
                  </span>
                {% endif %}
                {{ block.settings.heading }}
              </span>
              <span class="collapsible-content__toggle-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19" class="collapsible-content__plus-line"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </span>
            </button>
            <div 
              class="collapsible-content__panel" 
              id="accordion-content-{{ block.id }}"
              {% if forloop.first and section.settings.open_first %}data-open="true"{% endif %}
              data-accordion-panel
            >
              <div class="collapsible-content__panel-inner">
                {{ block.settings.content }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<style>
  .collapsible-content { padding: 80px 0; background: var(--color-background); }
  .collapsible-content__layout { max-width: 900px; margin: 0 auto; }
  .collapsible-content__layout--split { display: grid; grid-template-columns: 1fr 1.5fr; gap: 60px; max-width: 1200px; align-items: start; }
  .collapsible-content__header { margin-bottom: 50px; opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .collapsible-content__header.is-visible { opacity: 1; transform: translateY(0); }
  .collapsible-content__layout--split .collapsible-content__header { position: sticky; top: 120px; margin-bottom: 0; }
  .collapsible-content__title { font-size: clamp(2rem, 5vw, 3rem); margin: 0 0 15px; letter-spacing: -0.02em; }
  .collapsible-content__subtitle { font-size: 1.1rem; color: var(--color-text-muted, #666); line-height: 1.6; }
  .collapsible-content__items { display: flex; flex-direction: column; }
  .collapsible-content__item { border-bottom: 1px solid var(--color-border, rgba(0,0,0,0.1)); opacity: 0; transform: translateY(20px); transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .collapsible-content__item.is-visible { opacity: 1; transform: translateY(0); }
  .collapsible-content__trigger { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 25px 0; background: none; border: none; cursor: pointer; text-align: left; font-size: 1.1rem; font-weight: 500; color: inherit; transition: all 0.3s ease; }
  .collapsible-content__trigger:hover { color: var(--color-accent, #c8f542); }
  .collapsible-content__trigger-text { display: flex; align-items: center; gap: 15px; }
  .collapsible-content__icon { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; background: var(--color-card-bg, #f5f5f5); flex-shrink: 0; }
  .collapsible-content__toggle-icon { width: 24px; height: 24px; flex-shrink: 0; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .collapsible-content__trigger[aria-expanded="true"] .collapsible-content__toggle-icon { transform: rotate(45deg); }
  .collapsible-content__plus-line { transition: opacity 0.3s ease; }
  .collapsible-content__trigger[aria-expanded="true"] .collapsible-content__plus-line { opacity: 0; }
  .collapsible-content__panel { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .collapsible-content__panel[data-open="true"] { grid-template-rows: 1fr; }
  .collapsible-content__panel-inner { overflow: hidden; }
  .collapsible-content__panel-inner > * { padding-bottom: 25px; font-size: 1rem; line-height: 1.7; color: var(--color-text-muted, #666); }
  @media (max-width: 900px) { .collapsible-content__layout--split { grid-template-columns: 1fr; gap: 40px; } .collapsible-content__layout--split .collapsible-content__header { position: static; } .collapsible-content { padding: 50px 0; } }
</style>

<script>
  (function() {
    const section = document.querySelector('.section-{{ section.id }}');
    if (!section) return;
    
    const triggers = section.querySelectorAll('[data-accordion-trigger]');
    
    triggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const item = trigger.closest('[data-accordion-item]');
        const panel = item.querySelector('[data-accordion-panel]');
        const isOpen = trigger.getAttribute('aria-expanded') === 'true';
        
        if ({{ section.settings.allow_multiple | json }} === false) {
          section.querySelectorAll('[data-accordion-trigger]').forEach(t => {
            t.setAttribute('aria-expanded', 'false');
            t.closest('[data-accordion-item]').querySelector('[data-accordion-panel]').removeAttribute('data-open');
          });
        }
        
        trigger.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
        if (isOpen) {
          panel.removeAttribute('data-open');
        } else {
          panel.setAttribute('data-open', 'true');
        }
      });
    });
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const delay = entry.target.dataset.delay || 0;
          setTimeout(() => entry.target.classList.add('is-visible'), delay);
        }
      });
    }, { threshold: 0.1 });
    
    section.querySelectorAll('[data-scroll-reveal]').forEach(el => observer.observe(el));
  })();
</script>

{% schema %}
{
  "name": "Collapsible Content",
  "tag": "section",
  "class": "section-collapsible-content",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Frequently Asked Questions" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Find answers to common questions about our products and services." },
    { "type": "select", "id": "layout", "label": "Layout", "options": [{"value": "stacked", "label": "Stacked"}, {"value": "split", "label": "Split (Heading Left)"}], "default": "stacked" },
    { "type": "checkbox", "id": "open_first", "label": "Open first item by default", "default": true },
    { "type": "checkbox", "id": "allow_multiple", "label": "Allow multiple items open", "default": false }
  ],
  "blocks": [
    {
      "type": "collapsible_row",
      "name": "Collapsible Row",
      "settings": [
        { "type": "text", "id": "heading", "label": "Heading", "default": "Question here" },
        { "type": "richtext", "id": "content", "label": "Content", "default": "<p>Answer content goes here.</p>" },
        { "type": "select", "id": "icon", "label": "Icon", "options": [{"value": "none", "label": "None"}, {"value": "shipping", "label": "Shipping"}, {"value": "returns", "label": "Returns"}, {"value": "quality", "label": "Quality"}, {"value": "support", "label": "Support"}], "default": "none" }
      ]
    }
  ],
  "presets": [{ "name": "Collapsible Content", "blocks": [{"type": "collapsible_row", "settings": {"heading": "What is your shipping policy?", "content": "<p>We offer free shipping on orders over $50.</p>"}}, {"type": "collapsible_row", "settings": {"heading": "How do I return an item?", "content": "<p>Returns are easy! Simply contact us within 30 days.</p>"}}, {"type": "collapsible_row", "settings": {"heading": "Do you offer international shipping?", "content": "<p>Yes, we ship worldwide.</p>"}}] }]
}
{% endschema %}
